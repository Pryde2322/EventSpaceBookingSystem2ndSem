<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             x:Class="EventSpaceBookingSystem.View.ExplorePage"
             BackgroundColor="#D3D3D3">

    <!-- Use a Grid with two rows: scrollable content above, fixed nav bar below -->
    <Grid RowDefinitions="*, Auto">

        <!-- Main scrollable content -->
        <ScrollView Grid.Row="0">
            <StackLayout Spacing="0">
                <StackLayout  Spacing="0"  IsVisible="{Binding IsLoggedIn}">
                    <!-- HEADER: Greeting + Notification + Settings -->
                    <Grid Padding="15,10" ColumnDefinitions="*, Auto" BackgroundColor="White">
                        <Label Grid.Column="0" Text="{Binding Username, StringFormat='Hello {0}!'}" FontSize="30" FontAttributes="Bold" VerticalOptions="Center" HorizontalOptions="Start"/>
                        <HorizontalStackLayout Grid.Column="1" Spacing="15" VerticalOptions="Center" HorizontalOptions="End" Padding="0,0,0,0">
                            <ImageButton Padding="10" Source="notification_icon.png" WidthRequest="16" HeightRequest="16" Aspect="AspectFit" BackgroundColor="Transparent" Clicked="OnNotificationClicked"/>
                            <ImageButton Padding="10" Source="settings_icon.png" WidthRequest="16" HeightRequest="16" Aspect="AspectFit" BackgroundColor="Transparent" Clicked="OnSettingsClicked"/>
                        </HorizontalStackLayout>
                    </Grid>
                </StackLayout>

                <!-- Content Card -->
                <Frame BackgroundColor="White" Margin="30,15,30,30" CornerRadius="0" HasShadow="False" Padding="20" WidthRequest="410">

                    <StackLayout Spacing="15">

                        <!-- Header Information -->
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <!-- Book Now row -->
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Venue Placeholder Image -->
                            <Frame Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                                   BackgroundColor="#F0F0F0"
                                   WidthRequest="310" HeightRequest="310"
                                   Padding="20" CornerRadius="10"
                                   Margin="0,0,15,0">
                                <Image Source="{Binding FirstRelatedImage}" Aspect="AspectFill" WidthRequest="210" HeightRequest="210"/>
                            </Frame>

                            <!-- Venue Name and Category -->
                            <StackLayout Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Spacing="3" Margin="0,40,0,0">
                                <Label Text="{Binding NameSpace}" FontSize="18" FontAttributes="Bold"/>
                                <Label Text="{Binding Category}" FontSize="14" TextColor="#666666"/>
                            </StackLayout>

                            <!-- Descriptions -->
                            <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Text="{Binding Description1}" FontSize="12" TextColor="#666666"/>
                            <Label Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" Text="{Binding Description2}" FontSize="12" TextColor="#666666"/>

                            <!-- Rating and Capacity -->
                            <StackLayout Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" Spacing="5">
                                <StackLayout Orientation="Horizontal" Padding="0,10,0,0">
                                    <Label Text="{Binding StarDisplay}" TextColor="Gold" FontSize="16"/>
                                    <Label Text="{Binding Rating}" FontSize="14" VerticalOptions="Center"/>
                                </StackLayout>
                                <Label Text="{Binding Capacity, StringFormat='Upto {0} Guests'}" FontSize="14"/>
                            </StackLayout>

                            <!-- Book Now Section (price and "day" on same line) -->
                            <Grid Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2" Padding="0,20,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Label Grid.Column="0"
                                       Text="{Binding Price, StringFormat='₱{0:N2} /'}"
                                       FontAttributes="Bold"
                                       FontSize="18"
                                       TextColor="Black"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Start"/>

                                <Label Grid.Column="1"
                                       Text="day"
                                       FontAttributes="Bold"
                                       FontSize="18"
                                       TextColor="Black"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Start"/>

                                <Button Grid.Column="2"
                                        Text="Book Now"
                                        BackgroundColor="Black"
                                        TextColor="White"
                                        CornerRadius="20"
                                        Padding="15,5"
                                        FontSize="14"
                                        WidthRequest="100"
                                        HorizontalOptions="End"
                                        VerticalOptions="Center"
                                        Clicked="OnBookNowClicked" />
                            </Grid>
                        </Grid>


                        <!-- Add this after your current "Book Now" button section -->
                        <Frame x:Name="BookingOptionsFrame" IsVisible="{Binding IsBookingVisible}" BackgroundColor="#E5E5E5" Margin="0,10,0,15" CornerRadius="15" HasShadow="False" Padding="12">
                            <StackLayout Spacing="12">
                                <!-- Booking Date -->
                                <Frame Padding="10" BackgroundColor="White" CornerRadius="10" HasShadow="False" HorizontalOptions="FillAndExpand">
                                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                        <Label Text="Booking Date" FontSize="14" TextColor="Black" VerticalOptions="Center" />
                                        <DatePicker MinimumDate="{Binding MinBookingDate}" Date="{Binding BookingDate}" HorizontalOptions="FillAndExpand" />
                                    </HorizontalStackLayout>
                                </Frame>

                                <!-- Number of Guests -->
                                <Frame Padding="10" BackgroundColor="White" CornerRadius="10" HasShadow="False" HorizontalOptions="FillAndExpand">
                                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                        <Label Text="Number of Guests" FontSize="14" TextColor="Black" VerticalOptions="Center" />
                                        <Picker ItemsSource="{Binding GuestOptions}" SelectedItem="{Binding SelectedGuestCount}" HorizontalOptions="FillAndExpand" />
                                    </HorizontalStackLayout>
                                </Frame>

                                <!-- Time of Event -->
                                <Frame Padding="10" BackgroundColor="White" CornerRadius="10" HasShadow="False" HorizontalOptions="FillAndExpand">
                                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                        <Label Text="Time of Event" FontSize="14" TextColor="Black" VerticalOptions="Center" />
                                        <Picker ItemsSource="{Binding TimeOptions}" SelectedItem="{Binding SelectedTimeSlot}" HorizontalOptions="FillAndExpand" />
                                    </HorizontalStackLayout>
                                </Frame>

                                <!-- Extras (stacked vertically for readability) -->
                                <Frame Padding="10" BackgroundColor="White" CornerRadius="10" HasShadow="False" HorizontalOptions="FillAndExpand">
                                    <StackLayout Spacing="10">
                                        <HorizontalStackLayout Spacing="8" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                            <CheckBox IsChecked="{Binding IsExtraChairsChecked}" />
                                            <Label Text="Extra Chairs" VerticalOptions="Center" TextColor="#888888" />
                                            <Picker ItemsSource="{Binding ExtraChairsOptions}" SelectedItem="{Binding SelectedExtraChairs}" IsEnabled="{Binding IsExtraChairsChecked}" HorizontalOptions="FillAndExpand" />
                                        </HorizontalStackLayout>
                                        <HorizontalStackLayout Spacing="8" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                            <CheckBox IsChecked="{Binding IsTimeExtensionChecked}" />
                                            <Label Text="Time Extension" VerticalOptions="Center" TextColor="#888888" />
                                            <Picker ItemsSource="{Binding TimeExtensionOptions}" SelectedItem="{Binding SelectedTimeExtension}" IsEnabled="{Binding IsTimeExtensionChecked}" HorizontalOptions="FillAndExpand" />
                                        </HorizontalStackLayout>
                                    </StackLayout>
                                </Frame>

                                <!-- Confirm Button -->
                                <Button Text="Confirm" BackgroundColor="Black" TextColor="White" CornerRadius="20" Command="{Binding ConfirmBookingCommand}" HorizontalOptions="End" WidthRequest="120" />
                            </StackLayout>
                        </Frame>

                        <!-- Related Images Title -->
                        <Label Text="Images" FontSize="20" FontAttributes="Bold" Margin="15,0,0,10"/>

                        <!-- Related Images Section -->
                        <CollectionView ItemsSource="{Binding RelatedImages}"
                                        HeightRequest="120"
                                        Margin="0,0,0,0"
                                        HorizontalScrollBarVisibility="Never"
                                        VerticalScrollBarVisibility="Never">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="0"/>
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame Padding="0"
                                           WidthRequest="300"
                                           HeightRequest="300"
                                           CornerRadius="0"
                                           HasShadow="False"
                                           BorderColor="Transparent"
                                           Margin="0"
                                           BackgroundColor="#E5E5E5">
                                        <Image Source="{Binding}" Aspect="AspectFill" />
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </StackLayout>
                </Frame>
            </StackLayout>
        </ScrollView>

        <!-- NAVIGATION BAR (fixed at bottom) -->
        <Grid Grid.Row="1" Padding="0" ColumnDefinitions="*,*,*,*" BackgroundColor="White" IsVisible="{Binding IsLoggedIn}">
            <!-- HOME -->
            <Grid Grid.Column="0">
                <StackLayout Padding="0,20" BackgroundColor="#D3D3D3">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnHomeClicked" />
                    </StackLayout.GestureRecognizers>
                    <HorizontalStackLayout Spacing="5" HorizontalOptions="Center">
                        <Image Source="home_icon.png" WidthRequest="22" HeightRequest="22"/>
                        <Label Text="HOME" FontSize="14" FontAttributes="Bold" VerticalOptions="Center" TextColor="Black"/>
                    </HorizontalStackLayout>
                </StackLayout>
            </Grid>

            <!-- VENUES -->
            <Grid Grid.Column="1">
                <StackLayout Padding="0,20" BackgroundColor="Transparent">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnExploreClicked" />
                    </StackLayout.GestureRecognizers>
                    <HorizontalStackLayout Spacing="5" HorizontalOptions="Center">
                        <Image Source="explore_icon.png" WidthRequest="22" HeightRequest="22"/>
                        <Label Text="Venues" FontSize="14" VerticalOptions="Center" TextColor="Black"/>
                    </HorizontalStackLayout>
                </StackLayout>
            </Grid>

            <!-- CART -->
            <Grid Grid.Column="2">
                <StackLayout Padding="0,20" BackgroundColor="Transparent">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCartClicked" />
                    </StackLayout.GestureRecognizers>
                    <HorizontalStackLayout Spacing="5" HorizontalOptions="Center">
                        <Image Source="cart_icon.png" WidthRequest="22" HeightRequest="22"/>
                        <Label Text="Cart" FontSize="14" VerticalOptions="Center" TextColor="Black"/>
                    </HorizontalStackLayout>
                </StackLayout>
            </Grid>

            <!-- OWNER -->
            <Grid Grid.Column="3"
                  IsVisible="{Binding UserStatus, Converter={StaticResource StatusToVisibilityConverter}}">
                <StackLayout Padding="0,20" BackgroundColor="Transparent">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnBecomeOwnerClicked" />
                    </StackLayout.GestureRecognizers>
                    <HorizontalStackLayout Spacing="5" HorizontalOptions="Center">
                        <Image Source="owner_icon.png" WidthRequest="22" HeightRequest="22"/>
                        <Label Text="EventHub" FontSize="14" VerticalOptions="Center" TextColor="Black" LineBreakMode="TailTruncation"/>
                    </HorizontalStackLayout>
                </StackLayout>
            </Grid>
        </Grid>

    </Grid>
</ContentPage>